
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pass the Ace</title>
  <style>
    html, body {
      margin: 0;
      background: #121212;
      overflow: hidden;
      font-family: sans-serif;
    }
    canvas {
      display: block;
      background: url('./poker_table_background.png') no-repeat center center;
      background-size: cover;
    }
    #ui {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      z-index: 2;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      background: #333;
      color: white;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #555;
    }
  </style>
</head>
<body>
  <div id="ui">
    <button onclick="startGame()">Start Game</button>
    <button onclick="toggleSound()">ðŸ”Š</button>
    <div id="actionBtns" style="display:none;">
      <button onclick="keepCard()">Keep</button>
      <button onclick="passCard()">Pass</button>
    </div>
  </div>
  <canvas id="gameCanvas" width="1024" height="576"></canvas>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const CARD_W = 80, CARD_H = 120;
    const CENTER_X = canvas.width / 2;
    const CENTER_Y = canvas.height / 2;
    const RX = 300, RY = 180;

    let players = [];
    let dealerCard = null;
    let deck = [];
    let currentPlayer = 0;
    let isSoundOn = true;

    const cardImages = {};
    const avatarImages = {};
    const sounds = {};

    function preloadAssets() {
      for (let suit of ['S','H','D','C']) {
        for (let r of [2,3,4,5,6,7,8,9,10,'J','Q','K','A']) {
          let img = new Image();
          img.src = `./assets/cards/${r}${suit}.png`;
          cardImages[`${r}${suit}`] = img;
        }
      }
      for (let i = 1; i <= 10; i++) {
        let img = new Image();
        img.src = `./assets/avatars/avatar${i}.png`;
        avatarImages[i] = img;
      }
      for (let name of ['deal','chip','win','lose']) {
        let s = new Audio(`./assets/sounds/${name}.mp3`);
        sounds[name] = s;
      }
    }

    function toggleSound() {
      isSoundOn = !isSoundOn;
    }

    function playSound(name) {
      if (isSoundOn && sounds[name]) sounds[name].play();
    }

    function createDeck() {
      const d = [];
      for (let s of ['S','H','D','C']) {
        for (let r of [2,3,4,5,6,7,8,9,10,'J','Q','K','A']) {
          d.push({suit: s, rank: r});
        }
      }
      return d.sort(() => Math.random() - 0.5);
    }

    function getCardValue(card) {
      if (typeof card.rank === "number") return card.rank;
      return {J:11, Q:12, K:13, A:14}[card.rank];
    }

    function drawTable(showCards = false) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      players.forEach((p, i) => {
        const angle = (2 * Math.PI / players.length) * i - Math.PI / 2;
        const x = CENTER_X + Math.cos(angle) * RX;
        const y = CENTER_Y + Math.sin(angle) * RY;

        // Avatar
        const avatar = avatarImages[p.id];
        if (avatar) ctx.drawImage(avatar, x - 32, y - 100, 64, 64);

        // Card
        const card = showCards ? cardImages[`${p.card.rank}${p.card.suit}`] : cardImages["Back"];
        if (card) ctx.drawImage(card, x - CARD_W/2, y - CARD_H/2, CARD_W, CARD_H);

        // Label
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.fillText(`P${p.id} (${p.chips})`, x, y + CARD_H / 2 + 20);
        if (i === currentPlayer) ctx.fillText("â¬†", x, y + CARD_H / 2 + 35);
      });
    }

    function startGame() {
      deck = createDeck();
      players = Array.from({length: 10}, (_, i) => ({
        id: i + 1,
        card: null,
        chips: 3
      }));
      players.forEach(p => p.card = deck.pop());
      dealerCard = deck.pop();
      players.sort((a, b) => getCardValue(b.card) - getCardValue(a.card));
      currentPlayer = 0;
      drawTable();
      document.getElementById("actionBtns").style.display = "block";
      playSound("deal");
    }

    function keepCard() {
      nextTurn();
    }

    function passCard() {
      if (currentPlayer < players.length - 1) {
        [players[currentPlayer].card, players[currentPlayer+1].card] =
          [players[currentPlayer+1].card, players[currentPlayer].card];
      } else {
        [players[currentPlayer].card, dealerCard] =
          [dealerCard, players[currentPlayer].card];
      }
      playSound("chip");
      nextTurn();
    }

    function nextTurn() {
      currentPlayer++;
      if (currentPlayer >= players.length) endRound();
      else drawTable();
    }

    function endRound() {
      drawTable(true);
      const loser = players.reduce((min, p) =>
        getCardValue(p.card) < getCardValue(min.card) ? p : min
      );
      loser.chips--;
      playSound("lose");

      if (loser.chips <= 0) {
        players = players.filter(p => p.id !== loser.id);
      }

      setTimeout(() => {
        if (players.length === 1) {
          alert(`Player ${players[0].id} wins!`);
          playSound("win");
          document.getElementById("actionBtns").style.display = "none";
        } else {
          startGame();
        }
      }, 1200);
    }

    preloadAssets();
  </script>
</body>
</html>
