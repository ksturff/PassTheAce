<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pass the Ace - Deluxe Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      background: #111;
      overflow: hidden;
      color: white;
      font-family: 'Orbitron', sans-serif;
    }
    canvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }
    #ui {
      position: absolute;
      bottom: 40px;
      right: 40px;
      text-align: right;
      z-index: 10;
    }
    button {
      margin: 5px;
      padding: 12px 25px;
      font-size: 18px;
      background: linear-gradient(45deg, #444, #888);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 0 10px #00f7ff;
      transition: 0.3s;
    }
    button:hover {
      background: linear-gradient(45deg, #666, #aaa);
      box-shadow: 0 0 20px #00f7ff;
    }
    #playerContainer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2;
    }
    .player-ui {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      text-align: center;
      pointer-events: none;
    }
    .hud {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .hud .name {
      background: #000;
      color: white;
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 20px;
    }
    .hud .avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 0 4px #000;
    }
    .hud .avatar.active-glow {
      box-shadow: 0 0 12px 4px #00f7ff, 0 0 24px 6px #0ff;
      border-color: #0ff;
    }
    .hud .chips {
      font-size: 10px;
      color: gold;
      display: flex;
      align-items: center;
      gap: 3px;
    }
    .player-card {
      width: 60px;
      height: 90px;
      border-radius: 6px;
      position: absolute;
      z-index: 1;
    }
    .floating-card {
      position: absolute;
      width: 60px;
      height: 90px;
      z-index: 999;
      pointer-events: none;
      transition: left 0.5s ease-in-out, top 0.5s ease-in-out;
    }
    #endOverlay {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      color: white;
      font-size: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 20;
    }
    #endOverlay button {
      font-size: 22px;
      margin-top: 20px;
      background: #28a745;
      box-shadow: 0 0 15px #28a745;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="1024" height="600"></canvas>

  <div id="ui">
    <button id="startBtn" onclick="startGame()">Start Game</button>
    <div id="actionBtns" style="display:none;">
      <button onclick="keepCard()">Keep</button>
      <button onclick="passCard()">Pass</button>
    </div>
  </div>

  <div id="endOverlay">
    <div id="winMessage">Player X Wins!</div>
    <button onclick="restartGame()">Play Again</button>
  </div>

  <div id="playerContainer"></div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const playerContainer = document.getElementById("playerContainer");

    const playerPositions = [
      { x: 100, y: 80 }, { x: 320, y: 40 }, { x: 512, y: 30 }, { x: 700, y: 40 }, { x: 920, y: 80 },
      { x: 920, y: 480 }, { x: 700, y: 520 }, { x: 512, y: 530 }, { x: 320, y: 520 }, { x: 100, y: 480 }
    ];
    const cardPositions = [
      { x: 312, y: 200 }, { x: 412, y: 200 }, { x: 512, y: 200 }, { x: 612, y: 200 }, { x: 712, y: 200 },
      { x: 312, y: 320 }, { x: 412, y: 320 }, { x: 512, y: 320 }, { x: 612, y: 320 }, { x: 712, y: 320 }
    ];

    let players = [];
    let deck = [], currentPlayer = 0, dealerIndex = 0;
    let gameRunning = false;

    function createDeck() {
      const suits = ['S', 'H', 'D', 'C'];
      const ranks = [2,3,4,5,6,7,8,9,10,'J','Q','K','A'];
      return suits.flatMap(suit => ranks.map(rank => ({ suit, rank }))).sort(() => Math.random() - 0.5);
    }

    function getCardValue(card) {
      if (typeof card.rank === 'number') return card.rank;
      return { J: 11, Q: 12, K: 13, A: 1 }[card.rank];
    }

    function startGame() {
      players = Array.from({ length: 10 }, (_, i) => ({
        id: i + 1,
        chips: 3,
        card: null
      }));
      gameRunning = true;
      document.getElementById("endOverlay").style.display = "none";
      document.getElementById("startBtn").style.display = "none";
      dealCards();
    }

    function dealCards() {
      deck = createDeck();
      players.forEach(p => p.card = deck.pop());
      dealerIndex = players.reduce((highestIdx, p, i) =>
        getCardValue(p.card) > getCardValue(players[highestIdx].card) ? i : highestIdx, 0);
      currentPlayer = (dealerIndex + 1) % players.length;
      drawTable();
      processTurn();
    }

    function drawTable() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      playerContainer.innerHTML = "";

      // Draw cards
      players.forEach((p, i) => {
        const cardPos = cardPositions[i];
        const card = new Image();
        card.src = "./assets/Back.png";
        card.onload = () => ctx.drawImage(card, cardPos.x, cardPos.y, 60, 90);
        if (card.complete) ctx.drawImage(card, cardPos.x, cardPos.y, 60, 90);
      });

      // Draw HUD
      players.forEach((p, i) => {
        const pos = playerPositions[i];
        const div = document.createElement("div");
        div.className = "player-ui";
        div.style.left = `${pos.x}px`;
        div.style.top = `${pos.y}px`;

        const cardImg = document.createElement("img");
        cardImg.className = "player-card";
        cardImg.src = "./assets/Back.png";

        const nameDiv = document.createElement("div");
        nameDiv.className = "name";
        nameDiv.textContent = `Player ${p.id}`;

        const avatar = document.createElement("img");
        avatar.className = "avatar";
        avatar.src = "./assets/avatar.png";
        if (i === currentPlayer) avatar.classList.add("active-glow");

        const chipDiv = document.createElement("div");
        chipDiv.className = "chips";
        chipDiv.innerHTML = `<img src="./assets/coin.png" style="height:14px;" /> ${p.chips}`;

        const hud = document.createElement("div");
        hud.className = "hud";
        hud.appendChild(nameDiv);
        hud.appendChild(avatar);
        hud.appendChild(chipDiv);

        div.appendChild(cardImg);
        div.appendChild(hud);
        playerContainer.appendChild(div);
      });
    }

    function processTurn() {
      if (players.length <= 1) return;
      if (players[currentPlayer].id === 1) {
        document.getElementById("actionBtns").style.display = "block";
      } else {
        setTimeout(() => {
          let p = players[currentPlayer];
          let next = players[(currentPlayer + 1) % players.length];
          let shouldPass = getCardValue(p.card) < 8 && getCardValue(next.card) !== 13;
          if (shouldPass) [p.card, next.card] = [next.card, p.card];
          advanceTurn();
        }, 1000);
      }
    }

    function keepCard() {
      document.getElementById("actionBtns").style.display = "none";
      advanceTurn();
    }

    function passCard() {
      let p = players[currentPlayer];
      let next = players[(currentPlayer + 1) % players.length];
      if (p.card && next.card && getCardValue(next.card) !== 13) {
        [p.card, next.card] = [next.card, p.card];
      }
      document.getElementById("actionBtns").style.display = "none";
      advanceTurn();
    }

    function advanceTurn() {
      currentPlayer = (currentPlayer + 1) % players.length;
      if (currentPlayer === dealerIndex) {
        endRound();
      } else {
        drawTable();
        processTurn();
      }
    }

    function endRound() {
      const minVal = Math.min(...players.map(p => getCardValue(p.card)));
      players.forEach(p => {
        if (getCardValue(p.card) === minVal) p.chips--;
      });
      players = players.filter(p => p.chips > 0);
      if (players.length === 1) {
        document.getElementById("winMessage").innerText = `üèÜ Player ${players[0].id} Wins!`;
        document.getElementById("endOverlay").style.display = "flex";
        return;
      }
      dealerIndex = 0;
      currentPlayer = 1;
      dealCards();
    }

    function restartGame() {
      startGame();
    }
  </script>
</body>
</html>
